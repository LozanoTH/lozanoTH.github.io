<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat</title>

<div id="header"></div>

<script>
fetch("./utilidades/hedder.html")
.then(r=>r.text())
.then(t=>{
  header.innerHTML = t;

  const menu = document.getElementById("menu");
  const btn = document.getElementById("btn");
  const overlay = document.getElementById("overlay");
  const salir = document.getElementById("salir");

  btn.onclick = () => {
    menu.style.left = "0";
    overlay.style.display = "block";
  };

  overlay.onclick = () => {
    menu.style.left = "-250px";
    overlay.style.display = "none";
  };

  salir.onclick = () => {
    localStorage.clear();
    location.href = "index.html";
  };
});
</script> <br />




<style>
body {
  margin: 0;
  font-family: Arial;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

#chat {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
}

.msg {
  margin-bottom: 10px;
}

.user {
  font-weight: bold;
}

.time {
  font-size: 12px;
  color: gray;
}

#box {
  display: flex;
  border-top: 1px solid #ccc;
}

#text {
  flex: 1;
  padding: 10px;
  border: none;
  outline: none;
}

button {
  padding: 10px 15px;
  border: none;
  cursor: pointer;
}
</style>
</head>
<body>

<script>
if (localStorage.getItem("auth") !== "true") {
  location.href = "index.html";
}
</script>

<div id="chat"></div>

<div id="box">
  <input id="text" placeholder="Escribe un mensaje">
  <button onclick="send()">Enviar</button>
</div>

<script>
const URL = "https://lozano-1690859356322-default-rtdb.firebaseio.com/chat.json";
const user = localStorage.getItem("user");
const chat = document.getElementById("chat");

async function load() {
  const res = await fetch(URL);
  const data = await res.json();
  chat.innerHTML = "";

  for (let id in data) {
    const m = data[id];
    chat.innerHTML += `
      <div class="msg">
        <div class="user">${m.user}</div>
        <div>${m.text}</div>
        <div class="time">${m.time}</div>
      </div>
    `;
  }
  chat.scrollTop = chat.scrollHeight;
}

async function send() {
  const text = document.getElementById("text").value;
  if (!text) return;

  const msg = {
    user,
    text,
    time: new Date().toLocaleTimeString()
  };

  await fetch(URL, {
    method: "POST",
    body: JSON.stringify(msg)
  });

  document.getElementById("text").value = "";
  load();
}

setInterval(load, 2000);
load();
</script>

</body>
</html>
